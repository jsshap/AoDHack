
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
      .scrolly{
        height: 600px;
        overflow: auto;
      }
    </style>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6  scrolly justify-content-center">
          <!-- Event Display Buttons -->
          <div id="eDisplayBtns" class="btn-block" role="group">
          </div>
          <!-- END Event Display Buttons -->

          <!-- Button to trigger modal -->
          <button type="button" class="btn btn-outline-primary btn-lg" data-toggle="modal" data-target="#exampleModal">
            Add Event
          </button>
          <!-- END Button to trigger modal -->

          <!-- Button to trigger join event modal -->
          <button type="button" class="btn btn-outline-primary btn-lg" data-toggle="modal" data-target="#joinEventModal">
            Join An Event
          </button>
          <!-- END Button to trigger join event modal -->
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6  scrolly">
           Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam neque repellat libero facere, inventore natus! Laudantium laborum unde veritatis, nemo commodi ducimus quasi quam incidunt accusamus dolore asperiores optio repellendus!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam neque repellat libero facere, inventore natus! Laudantium laborum unde veritatis, nemo commodi ducimus quasi quam incidunt accusamus dolore asperiores optio repellendus!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam neque repellat libero facere, inventore natus! Laudantium laborum unde veritatis, nemo commodi ducimus quasi quam incidunt accusamus dolore asperiores optio repellendus!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsam neque repellat libero facere, inventore natus! Laudantium laborum unde veritatis, nemo commodi ducimus quasi quam incidunt accusamus dolore asperiores optio repellendus!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Exercitationem soluta corrupti, veniam sit, delectus sunt ipsum placeat recusandae eaque, voluptatum nemo optio cumque omnis veritatis quam itaque ab. Cupiditate, exercitationem?Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo dolorem adipisci sint ducimus voluptates eveniet qui nisi error reiciendis laborum sed, neque officia aspernatur omnis dolore consequuntur, natus optio, mollitia!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos enim expedita temporibus iure. Quam vitae autem laborum magnam optio nihil quisquam, est aliquid perspiciatis quia tempora cumque, enim vel.Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero quis veritatis, alias dicta, commodi adipisci sint natus reiciendis. Atque eius labore alias cum ratione beatae provident voluptatum eum id mollitia.
        </div>
      </div>
    </div>




    <!-- New Event Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Start New Event!</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="newEventInfo" onsubmit="go()" style="text-align: center; position: relative">

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">First Name</span>
                  </div>
                  <input type="text" id="fname" class="form-control" name="firstname" placeholder="Your first name.." aria-label="Username" aria-describedby="basic-addon1" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Last Name</span>
                  </div>
                  <input type="text" aria-label="Username" aria-describedby="basic-addon1" id="lname" name="lastname" placeholder="Your last name.." required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Email</span>
                  </div>
                  <input type="text" aria-label="Username" aria-describedby="basic-addon1" id="email" name="email" placeholder="stevejobs@gmail.com" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Minimum Participants</span>
                  </div>
                  <input type="text" aria-label="Username" aria-describedby="basic-addon1" id="minipart" name="minipart" placeholder='0' required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Maximum Participants</span>
                  </div>
                  <input type="text" aria-label="Username" aria-describedby="basic-addon1" id="maxpart" name="maxpart" placeholder='100' required>
                </div>


                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Event Title</span>
                  </div>
                  <input type="text" id="ename" name="maxpart" placeholder='John Doe'class="form-control" aria-label="Username" aria-describedby="basic-addon1" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Event Time</span>
                  </div>
                  <input type="text" aria-label="Username" aria-describedby="basic-addon1" id="etime" name="eventtime" placeholder="00:00:0000" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Event Location</span>
                  </div>
                  <input type="text" aria-label="Username" aria-describedby="basic-addon1" id="elocation" name="eventlocation" placeholder="Buckingham Palace" required>
                </div>

                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">Event Description</span>
                  </div>
                  <textarea class="form-control" aria-label="With textarea"name="edesc" placeholder="Write something.." id= "edesc" style="height:200px" required></textarea>
                </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" value="Submit" onclick="go()" class="btn btn-secondary" data-dismiss="modal">Create Event</button>
          </div>
        </div>
      </div>
    </div>
    <!-- END New Event Modal -->

    <!-- Join Event Modal -->
    <div class="modal fade" id="joinEventModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Join An Event!</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="joinEventForm" onsubmit="joinEvent()" style="text-align: center; position: relative">

              <label for="fname">First Name</label>
              <input type="text" id="fnameadd" name="firstname" placeholder="Your first name.." required>
              <br>

              <label for="lname">Last Name</label>
              <input type="text" id="lnameadd" name="lastname" placeholder="Your last name.." required>
              <br>

              <label for="email">Email</label>
              <input type="text" id="emailadd" name="email" placeholder="stevejobs@gmail.com" required>
              <br>

              <label for="eID">Event ID</label>
              <input type="text" id="eidadd" name="firstname" placeholder="The event ID" required>
              <br>

            </form>
          </div>
          <div class="modal-footer">
            <button type="button" value="Submit" onclick="joinEvent()" class="btn btn-secondary" data-dismiss="modal">Join</button>
          </div>
        </div>
      </div>
    </div>
    <!-- END Join Event Modal -->

    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script>
function apicall(d) {
  fetch("https://hwzgmbb5mg.execute-api.us-east-1.amazonaws.com/test/check", {
    method:"POST",
    body: JSON.stringify({
  "Description": d.Description,
  "EventID": d.EventID,
  "Location": d.Location,
  "Participants": d.Participants,
  "Time": d.Time,
  "Title": d.Title,
  "max": parseInt(d.max),
  "min": parseInt(d.min)
})
  });
}</script>

    <script>
    let config = {
      apiKey: "AIzaSyC8iaO8kb95S5mnUa2WLSCrCO-2Vq7RWiE",
      authDomain: "amherst-hangout.firebaseapp.com",
      projectId: "amherst-hangout",
      databaseURL: "https://amherst-hangout-default-rtdb.firebaseio.com/",
    };

    function createHangout(eventID, eventTitle, eventTime, eventLocation, eventMin, eventMax, eventDescription) {
      let config = {
        apiKey: "AIzaSyC8iaO8kb95S5mnUa2WLSCrCO-2Vq7RWiE",
        authDomain: "amherst-hangout.firebaseapp.com",
        projectId: "amherst-hangout",
        databaseURL: "https://amherst-hangout-default-rtdb.firebaseio.com/",
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(config);
      }

      this.database = firebase.database();
      let userRef = this.database.ref('Events/');

      let emptylist = [];


      userRef.child(eventID).set({
        'EventID': eventID,
          'Time': eventTime,
          'Location': eventLocation,
          'Title' : eventTitle,
          'Description': eventDescription,
          'min': eventMin,
          'max': eventMax,
          'Participants' : emptylist
      });

      console.log('this method finished.')

    }

    // function getEventInfo() {
    //   var eventsData;
    //   if (!firebase.apps.length) {
    //     firebase.initializeApp(config);
    //   }

    //   this.database = firebase.database();//not desired JSON data

    //   let userRef = this.database.ref('Events/');//not desired JSON data 

    //   userRef.on("value", 
    //   function(snapshot) {
    //     eventsData=snapshot.val();
    //   },
    //   function (errorObject) {
    //     console.log("The read failed: " + errorObject.code);
    //   }
    //   );
    //   return eventsData;
    // }

    function addParticipant(eventID,name,email) {
      let config = {
        apiKey: "AIzaSyC8iaO8kb95S5mnUa2WLSCrCO-2Vq7RWiE",
        authDomain: "amherst-hangout.firebaseapp.com",
        projectId: "amherst-hangout",
        databaseURL: "https://amherst-hangout-default-rtdb.firebaseio.com/",
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(config);
      }

      this.database = firebase.database();


      let userRef = this.database.ref('Events/' + eventID);

      // emptylist = [];
      // //Create participants list
      // userRef.child('Participants').set(emptylist)

      // Update (push participant to list)
      userRef.child('Participants').push({'Name': name, 'Email':email})

      userRef.on("value", function(snapshot) {



        var requestData = snapshot.val(); 

        apicall(requestData);
        console.log(requestData.Participants);


      }



      , function (errorObject) {
      console.log("The read failed: " + errorObject.code);
      });
        var requestData = {

        }
  

    }


    function go(){
      //event.preventDefault();
      var fname=document.getElementById("fname").value.toString();
      var lname=document.getElementById("lname").value.toString();
      var email=document.getElementById("email").value.toString();
      var minipart=document.getElementById("minipart").value.toString();
      var maxpart=document.getElementById("maxpart").value.toString();
      var ename=document.getElementById("ename").value.toString();
      var etime=document.getElementById("etime").value.toString();
      var elocation=document.getElementById("elocation").value.toString();
      var edesc=document.getElementById("edesc").value.toString();
      document.getElementById("newEventInfo").reset();
      var numEvents = Math.round(Math.random()*4206969);//EDIT THIS SHIT LATER!!
      createHangout(numEvents, ename, etime, elocation, minipart, maxpart, edesc);
      console.log(numEvents);
      addParticipant(numEvents,fname+' '+lname,email);
      alert("Your event has been submitted! You will receive an email when enough signups have occured.");
    }


    function joinEvent(){
      var eid=document.getElementById("eidadd").value.toString();
      var fname=document.getElementById("fnameadd").value.toString();
      var lname=document.getElementById("lnameadd").value.toString();
      var email=document.getElementById("emailadd").value.toString();
      addParticipant(eid,fname+' '+lname,email);
      alert("You've been added to the event! You will receive an email when enough signups have occured.");
    }


    function displayEvents(){
      var eventsData;
      if (!firebase.apps.length) {
        firebase.initializeApp(config);
      }

      this.database = firebase.database();//not desired JSON data

      let userRef = this.database.ref('Events/');//not desired JSON data 

      userRef.on("value", 
        function(snapshot) {
          document.getElementById("eDisplayBtns").innerHTML = "";
          eventsData=snapshot.val();
          for (event in eventsData){
            var eventButton = document.createElement('BUTTON');
            eventButton.innerHTML = 'Event ID: ' + event + ' || '+ eventsData[event].Title + ': ' + eventsData[event].Description +' || at ' +eventsData[event].Time;
            eventButton.className = "btn btn-primary btn-lg btn-block rounded-lg border";
            eventButton.type = "button";
            eventButton.id = eventsData[event].EventID;

            document.getElementById("eDisplayBtns").appendChild(eventButton);
          }
        },
        function (errorObject) {
          console.log("The read failed: " + errorObject.code);
        }
      );
    }

    function displayHomePage(){
      displayEvents();
    }

    displayHomePage(); //Home page's content depends on data that is loaded through scripts, so better to show it after loading
  </script>
  </body>
</html>
